<html>
<head>
    <title>COMETS Registration</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="/common/css/style.css" />
    <link rel="stylesheet" href="public/css/comets.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script type="application/javascript">
$(function() {
    $.get('/cometsRest/cohorts', function(data) {
        data = data.cohorts
        var cohortSelection = $('[name="cohort"]');
        for (var index in data) {
            cohortSelection.append('<option value="'+data[index]+'">'+data[index]+'</option>');
        }
        $.get(document.location,function(data,status,xhr) {
            var payload = JSON.parse(xhr.getResponseHeader("OIDC_id_token_payload"));
            console.log(payload);
            var user_metadata = payload.user_metadata||{};
            $('#email').html(payload.email);
            $('[name="family_name"]').val(user_metadata.family_name||payload.family_name||"");
            $('[name="given_name"]').val(user_metadata.given_name||payload.given_name||"");
            $('[name="affiliation"]').val(user_metadata.affiliation||"");
            $('[name="cohort"] option[value="'+(user_metadata.cohort||"")+'"]').attr('selected',true);
            $('[name="user_id"]').val(encodeURIComponent(payload.user_id));
        });
    });
    $('#submit').on('click',function(e) {
        e.preventDefault();
        $.post('/cometsRest/user_metadata',{
            'family_name': $('[name="family_name"]').val(),
            'given_name': $('[name="given_name"]').val(),
            'affiliation': $('[name="affiliation"]').val(),
            'cohort': $('[name="cohort"]').val(),
            'user_id': $('[name="user_id"]').val()
        }, function(data,status,xhr) {
            console.log(data);
        });
    });
});
    </script>
</head>
<body>
    <header>
        <a href="./index.html" target="_BLANK"><img src="./public/images/COMETSLogo.png" alt="COMETS Analytics" title="Banner of COMETS Analytics" /></a>
    </header>
    <div class="container-fluid">
        <div id="pageContent">
            <div class="container-fluid">
                <div class="row">
                    <div id='page-head' class="col-xs-12"><strong>CO</strong>nsortium of <strong>MET</strong>abolomics <strong>S</strong>tudies</div>
                </div>
            </div>
            <div>
                <div class="container">
                    <div class="row">
                        <h3><strong>Welcome</strong></h3>
                        <p>Welcome to the COMETS Registration process! To complete your account registration, you have to provide the information below. Please note you will not be able to sign in immediately after registration. You will receive a confirmation email upon approval.</p>
                    </div>
                    <div class="row">
                        <h3><strong>Information Needed</strong></h3>
                        <p>Please provide the following information to register your account in COMETS:</p>
                        <input type="hidden" name="user_id" value=""/>
                        <ul>
                            <li>
                                <b>Email Address:</b>
                                <span id="email"></span>
                            </li>
                            <li>
                                <b>Last Name:</b>
                                <input type="text" name="family_name" value=""/>
                            </li>
                            <li>
                                <b>First Name:</b>
                                <input type="text" name="given_name" value=""/>
                            </li>
                            <li>
                                <b>Affiliation:</b>
                                <input type="text" name="affiliation" value=""/>
                            </li>
                            <li>
                                <b>Cohort:</b>
                                <select name="cohort">
                                    <option value="">-- Select Cohort --</option>
                                </select>
                            </li>
                        </ul>
                        <input id="submit" type="button" value="Submit"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>