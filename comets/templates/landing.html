<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="collapse navbar-collapse" id="comets-tab-nav">
            <ul class="nav nav-pills">
                <li role="presentation" class="active"><a href="#tab-home" data-toggle="tab">Home</a></li>
                <li role="presentation"><a href="#tab-correlate" data-toggle="tab" id="correlateTabId" data-toggle="tab">Correlate</a></li>
                <li role="presentation"><a href="#tab-help" data-toggle="tab" id="helpTabId" data-toggle="tab">Help</a></li>
                <li class="pull-right">
                    <input type="button" class="btn btn-primary" id="logoutBtn" value="Logout" />
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="tab-content grey-border">
    <div class="tab-pane active" id="tab-home">
        <h2 id='page-head'><%= user %>, Welcome to the COMETS (COnsortium of METabolomics Studies) Analytics</h2>
        <div class="row">
            <h1>About</h1>
            <p>THis web-based application will support all cohort-specific analyses of the COMETS consortium. Data are not saved in the system, but output must be downloaded and submitted for meta-analyses. This collaborative work is done via the COMETS harmonization group activities. For more informationon the consortium, see COMETS website</p>
            <img src="images/cometsWorkflow.png" alt="diagram of the workflow for the comets application" />
        </div>
        <h3>For Questions or help:</h3>
        <p>COMETS: Steven Moore
            <br> UID file: Adam Risch
            <br> Harmonization: Ewy Mathe
            <br> Correlation: Ella Temprosa
            <br> Email:
            <a href="mailto:cometsanalytics@gmail.com">cometsanalytics@gmail.com</a>
        </p>
    </div>
    <!-- start quality Control Tab -->
    <div class="tab-pane" id="tab-qualityControl">
        <div class="row">
            <div class="col-md-4">
                <div class="well">
                    <div class="well well-nested">
                        <form name="qualityControlForm">
                            <div class="row">
                                <div class="col-xs-12"> &nbsp;</div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <label for="harmonizationFile">Input Harmonizated Data File (.csv format)</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <input id="harmonizationFile" type="file" accept=".csv">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12"> &nbsp;</div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <label for="mappingFile">Input Refmet Mapping File (e.g. at least 3 columns: UIDs, Biochemical name and Refmet columns) </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <input id="mappingFile" type="file">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- end of well -->
            </div>
            <div class="col-md-8">
                <div class="col-sx-12" id="qualityControlResult" style="display:none;">
                    <div class="row">
                        <div class="col-xs-12">
                            <b>Stats on Input Files</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <table width="50%" border="1">
                                <tbody>
                                    <tr>
                                        <th width="10%">&nbsp;</th>
                                        <th width="30%">Files</th>
                                        <th width="30%">NumRows</th>
                                        <th width="30%">NCols</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>Uids</td>
                                        <td>3148</td>
                                        <td>25</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Refmet</td>
                                        <td>3148</td>
                                        <td>5</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp;</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <b>Stats on metabolities in harmonized data file (uids)</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <table width="100%" border="1">
                                <tbody>
                                    <tr>
                                        <th width="10%">&nbsp;</th>
                                        <th width="50%">Type</th>
                                        <th width="40%">Number_metabolities</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>Total</td>
                                        <td>3148</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>With identified biochemical name</td>
                                        <td>1704</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>W/O identified biochemical name</td>
                                        <td>1444</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>With NCI_Name</td>
                                        <td>2588</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>With BROAD_Name</td>
                                        <td>350</td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>With FENLAND_METABOLON_NAME</td>
                                        <td>943</td>
                                    </tr>
                                    <tr>
                                        <td>7</td>
                                        <td>With FENLAND_BIOCRATES_NAME</td>
                                        <td>188</td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>With ARIC_NAME 1</td>
                                        <td>601</td>
                                    </tr>
                                    <tr>
                                        <td>9</td>
                                        <td>With ARIC_NAME 2</td>
                                        <td>1161</td>
                                    </tr>
                                    <tr>
                                        <td>10</td>
                                        <td>With UCLEB_NMR_NAME</td>
                                        <td>27</td>
                                    </tr>
                                    <tr>
                                        <td>11</td>
                                        <td>With SHANGHAI_CHD_NAME</td>
                                        <td>615</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp; </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <b>Of the identified metabolities, there is coverage in the following pathway database</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <table width="100%" border="1">
                                <tbody>
                                    <tr>
                                        <th width="10%">&nbsp;</th>
                                        <th width="45%">Type</th>
                                        <th width="45%">Number_Metabolities</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>HMDB</td>
                                        <td>1003</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>PUBCHEM</td>
                                        <td>987</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>CHEMSPIDER</td>
                                        <td>60</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>KEGG(Compound)</td>
                                        <td>562</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp; </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <b>How many input metabolities map to Refmet?</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <table width="100%" border="1">
                                <tbody>
                                    <tr>
                                        <th width="8%">&nbsp;</th>
                                        <th width="22%">Nun_Identified</th>
                                        <th width="22%">Refmet_mapped</th>
                                        <th width="22%">Perc_mapped</th>
                                        <th width="22%">Refmet_unmapped</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>1704</td>
                                        <td>1058</td>
                                        <td>62.09</td>
                                        <td>2090</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp; </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12"><b>Number of Platform a given metabolities appears in? </b> </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12"><img src="images/qualityControl.jpg" alt="Quality Control"> </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp; </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12"><b>Are there duplicate BIOCHEMICAL names with a different_Name </b></div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">The Refmet_name is not taken into account here </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp; </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12"><a href="#">Download list of duplicate BIOCHEMICAL metabolities names</a> </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end of quality Control Tab -->
    <!-- start harmonization Tab -->
    <div class="tab-pane" id="tab-harmonization">
        <div class="row">
            <div class="col-md-4">
                <div class="well">
                    <div class="well well-nested">
                        <form name="qualityControlForm">
                            <div class="row">
                                <div class="col-xs-12"> &nbsp;</div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <label for="metaboliteFile">Input List of metabolite names one name per line (.txt format)</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <input id="metaboliteFile" type="file" accept=".txt">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12"> &nbsp;</div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12"> &nbsp;</div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12"> &nbsp;</div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- end of well -->
            </div>
            <div class="col-md-8">
                <div class="col-xs-12" id="harmonizationDiv" style="display:none;">
                    <div class="row">
                        <div class="col-xs-12"><b>Check how many of the input metabolities are already harmonizaed by the COMETS harmonization group</b></div>
                    </div>
                    <div class="row">
                        <div class="col-xs-8">
                            <table width="80%" border="1">
                                <tbody>
                                    <tr>
                                        <th width="10%">&nbsp;</th>
                                        <th width="45%">Num_Harmonized</th>
                                        <th width="45%">Num_NonHarmonized</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>0</td>
                                        <td>3</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">&nbsp;</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12"><a href="#">Download list of non-harmonizaed metabolitites and send to COMETS harmonization group</a>
                            <br>
                            <a href="#">Download list of harmonized metabolities</a>
                            <br>
                            <br>
                            <br>
                            <br>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end of right panel -->
        </div>
    </div>
    <!-- end of harmonization Tab -->
    <!-- start correlate Tab -->
    <div class="tab-pane" id="tab-correlate">
        <div class="row">
            <div class="col-md-4">
                <form class="well" name="qualityControlForm">

                    <div class="form-group">
                        <label for="cohortSelection">1. Specify Cohort</label>
                        <select name="cohortSelection" id="cohortSelection" class="form-control">
                            <option value="">-- Select Cohort --</option>
                            <option value="DPP">DPP</option>
                            <option value="EPIC">EPIC</option>
                            <option value="PLCO-CRC">PLCO-CRC</option>
                            <option value="PLCO-breast">PLCO-breast</option>
                            <option value="Shanghai">Shanghai</option>
                            <option value="WHI">WHI</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div id="inputStep2" class="form-group">
                        <label for="inputDataFile">2. Choose Input Data File</label>
                        <input id="inputDataFile" type="file">
                        <div id="calcProgressbar" class="progress">
                            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                <!-- <span class="sr-only">60% Complete</span> -->
                            </div>
                        </div>
                    </div>
                    <div id="inputStep3">
                        <label for="methodSelection">3. Specify method of analyses</label>
                        <div class="radio">
                            <label for="methodSelection1">
                                <input type="radio" name="methodSelection" id="methodSelection1" value="batch" checked="">Batch as specfied in the input file
                            </label>
                        </div>
                        <div class="radio">
                            <label for="methodSelection2">
                                <input type="radio" name="methodSelection" id="methodSelection2" value="interactive">Interactive user input</label>
                        </div>
                        <div class="form-group">
                            <label for="modelSelection">Choose Model</label>
                            <select name="modelSelection" id="modelSelection" class="form-control">
                                <option value="unadjusted">Unadjusted</option>
                                <option value="BMI adjusted">BMI adjusted</option>
                            </select>
                        </div>
                        <div id="modelOptions"></div>
                    </div>
                    <a id="toggleHelp">Help</a>
                    <div id="inputHelp">
                        <h4>Input fields</h4> Specify the name of your cohort. If your cohort is not listed, please notify the harmonization group.

                        <h4>Integrity check</h4> The tab will display the results of the harmonization and integrity check results.

                        <h4>Summary</h4> The table of correlations and metabolite information is displayed with an option to download the results in CSV format. For each exposure, the correlation, n and p value are displayed. Please download the file for each model and send to data harmonization group.


                        <h4>Heatmap</h4> The heatmap displays the metabolites in rows and exposures in columns using partial (if adjustment variables are specified) spearman correlations. From this tab, you can download the heatmap as a png file, pan, zoom and get correlation coefficients. You can also sort the results using the dropdown menu.

                        <h4>Cluster and heatmap</h4> The cluster and heatmap is available for use when there are 2 or more exposures and 2 or more outcomes are specified.


                        <h4>Network</h4> Using the genenet package, we display the partial correlation network of your outcomes, exposures and adjusted covariates. There is an option to display the minimum correlation to display with a default of 0.40.


                    </div>

                </form>

            </div>
            <!-- end of well -->

            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-12">
                        <nav class="navbar navbar-default">
                            <!-- Collect the nav links, forms, and other content for toggling -->
                            <div class="collapse navbar-collapse" id="correlate-tab-nav">
                                <ul class="nav nav-pills">
                                    <li class="active"><a href="#tab-integrity" data-toggle="tab">Integrity Check</a></li>
                                    <li><a href="#tab-summary" data-toggle="tab">Summary</a></li>
                                    <li><a href="#tab-heatmap" data-toggle="tab" id="controlTabId">Heatmap</a></li>
                                    <li><a href="#tab-cluster" data-toggle="tab" id="harmonizationTabId">Cluster and Heatmap</a></li>
                                    <li><a href="#tab-network" data-toggle="tab" id="correlateTabId">Network</a></li>
                                </ul>
                            </div>
                        </nav>
                        <div class="tab-content grey-border">
                            <div class="row">
                                <div id="messageDiv"></div>
                            </div>
                            <div id="inputNotice" class="bg-info">
                                <b>Please import an Excel file on the left panel</b>
                            </div>
                            <div class="tab-pane active" id="tab-integrity">
                                <div id="integrityDiv" class="col-xs-12" style="display:none;">
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <h2 class="sectionTitle">Integrity Check Results</h2>
                                            <div id="integrityTable">
                                            </div>
                                            <img src="images/integrityCheck.jpg" class="img-responsive" alt="Summary">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab-summary">
                                <div id="summaryTable"></div>
                                <div id="summaryDiv" class="col-xs-12" style="display:none;">
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <img src="images/summary.jpg" alt="Summary" class="img-responsive">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab-heatmap">
                                <div id="heatmapDiv" class="col-xs-12" style="display:none;">
                                    <h2 class="sectionTitle">Correlation Heatmap</h2>
                                    <div class="form-group">
                                        <label for="sort">Select sort:</label>
                                        <select id="sort" class="form-control">
                                            <option value="metasc">Alphabetic (asc)</option>
                                            <option value="metabolite_name">Alphabetic (desc)</option>
                                            <option value="age">age</option>

                                        </select>
                                    </div>

                                    <div class="row">
                                        <div class="col-xs-12">
                                            <img src="images/heatmap.jpg" alt="heatmap" class="img-responsive">
                                            <!-- interactive heatmap produced using plotly https://plot.ly/python/getting-started/ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab-cluster">
                                <div id="clusterDiv" class="col-xs-12" style="display:none;">
                                    <h2 class="sectionTitle">Hierarchical clustering and heatmap</h2>
                                    <div class="form-group">
                                        <label for="palette">Palette</label>
                                        <select id="palette" class="form-control">
                                            <option value="YlOrRd">Yellow and Red</option>
                                            <option value="RdYlBu">Red Yellow and Blues</option>
                                            <option value="Greens">Greens</option>
                                            <option value="Blues">Blues</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="cluster">
                                            <input id="cluster" type="checkbox">
                                            <span>Apply clustering</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab-network">
                                <div id="networkDiv" class="col-xs-12" style="display:none;">
                                    <h2 class="sectionTitle">Correlation network among row, column and adjusted Covariates</h2>
                                    <label for="corr_cutoff">Correlation Cutoff</label>
                                    <div class="row">
                                        <div class="col-xs-10">
                                            <input id="corr_cutoff" type="range" min="0" max="1" step="0.01" value="0.01" />
                                        </div>
                                        <div class="col-xs-2">
                                            <input id="corr_val" type="number" min="0" max="1" step="0.01" value="0.01" aria-label="text entry for correlation cutoff slider control" />
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <img src="images/network.png" alt="Network" class="img-responsive">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end of row -->
            </div>
        </div>
        <!-- end of right panel -->
    </div>
    <!-- start help Tab -->
    <div class="tab-pane" id="tab-help">
        <div class="row">
            <h3 class="col-xs-12 col-md-1 steps">Step 1</h3>
            <div class="col-xs-12 col-md-10">
                <h3>Upload input file</h3>
                <p>The input file is currently in excel formate with 5 sheets. Download and use the example input file <a href="cometsInput.xlsx" title="example input excel file">here</a> as a template.</p>
                <ol>
                    <li> <b><i>Metabolites</i></b>
                        <br>This sheet serves as the metadata or information on the metabolites used for the harmonization step. Minimum required columns include analysis platform, metabolite name and metabolite id (ie. variable name of your metabolite). It is preferred to also include RT, m/z, chemical ID (HMDB, InChi key, or other identifier).
                    </li>
                    <li> <b><i>SubjectMetabolites</i></b>
                        <br> This sheet contains the abundances in columns and subject in rows. The subject identifier is expected in the first column and the remaining columns are considered as metabolite ids.
                    </li>
                    <li> <b><i>SubjectData</i></b>
                        <br> This sheet contains other exposure and adjustment variables for use in the analyses.
                    </li>
                    <li> <b><i>VarMap</i></b>
                        <br>This sheet is used to map the variables needed to conduct the cohort specific analysis. Specify the name of variables under CohortVariable column and add notes for your convenience. Cells in grey are protected. You will also need to specify the column name in the metabolites sheet corresponding to your metabolite_id.
                    </li>
                    <li> <b><i>Models</i></b>
                        <br> This sheet is used for the batch analyses mode and contains the model specifications. Outcomes, exposures and adjustment can specify multiple covariates delimited by spaces (ie: age bmi).
                    </li>
                </ol>
            </div>
        </div>
        <div class="row">
            <h3 class="col-xs-12 col-md-1 steps">Step 2</h3>
            <div class="col-xs-12 col-md-10">
                <h3>Harmonize Metabolites</h3>
                <p>
                    The harmonization step will assess whether your cohort’s metabolites are available in COMET’s master metabolites so that a universal ID (named UID_01) can be associated with your metabolites. The COMETS master metabolite list is maintained by IMS and can be sent in advance of the analyses to ensure availability of a universal ID for each of your metabolites. The universal ID (currently named UID_01) ensures alignment of metabolites across the different cohorts to ensure identification for meta-analysis.</p>
            </div>
        </div>


        <div class="row">
            <h3 class="col-xs-12 col-md-1 steps">Step 3</h3>
            <div class="col-xs-12 col-md-10">
                <h3>Data Integrity</h3>
                <p>
                    Data integrity checks are run to ensure the appropriate data are presented for analyses. The following conditions are checked:
                    <ol>
                        <li> Subject ID or Metabolite ID is/are not provided in the Varmap sheet
                        </li>
                        <li> Subject ID or Metabolite ID provided in Varmap sheet do not correspond to a column in “Metabolites” and “SubjectData” sheets, respectively
                        </li>
                        <li> Metabolites ids in Metabolites and SubjectMetabolites sheet do not match
                        </li>
                        <li> Subject ids in SubjectData and SubjectMetabolites sheet do not match
                        </li>
                    </ol>
                    If any of the following conditions failed, the analyses will be suspended and corrections to the data are required. The data integrity checks will also flag the following but will proceed with the analyses:
                    <ol>
                        <li> Number of subjects in “SubjectData” and “SubjectMetabolites” sheets do not match
                        </li>
                        <li> Metabolite abundances from “SubjectMetabolites” contains duplicate columns (metabolites) or rows (subjects)
                        </li>
                        <li> There are duplicate subject ids in Subject Information “SubjectData” sheet
                        </li>
                        <li> There are duplicate metabolite ids in Metabolite Information “Metabolites” sheet
                        </li>
                    </ol>
                </p>
            </div>
        </div>

        <div class="row">
            <h3 class="col-xs-12 col-md-1 steps">Step 4</h3>
            <div class="col-xs-12 col-md-10">
                <h3>Run Correlation Analyses</h3>
                <p>
                    The correlation analyses can be done in batch (as specified in the input file) or in interactive mode using user specified exposure and outcome variables. Heatmaps, hierarchical clustering, and network analyses of the computed correlations are also available.
                </p>
            </div>
        </div>

    </div>
    <!-- end of help tab content -->
</div>
<!-- end of correlate Tab -->
</div>